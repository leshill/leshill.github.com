<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
  <meta content='text/html; charset=utf-8' http-equiv='content-type' />
  <meta content='Les Hill' name='author' />
  <title>
    Wonderland &mdash; Home
  </title>
  <link href='/css/blueprint/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <link href='/css/blueprint/print.css' media='print' rel='stylesheet' type='text/css' />
  <!--[if IE]> <link rel="stylesheet" href="/css/blueprint/ie.css" type="text/css" media="screen, projection" /> <![endif]-->
  <link href='/css/coderay.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <link href='/css/jquery.twitter.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <link href='/css/site.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js' type='text/javascript'></script>
  <script src='/javascript/jquery.twitter.js' type='text/javascript'></script>
  <script src='/javascript/application.js' type='text/javascript'></script>
  <link href='http://feeds2.feedburner.com/leshill' rel='alternate' title='RSS feed' type='application/atom+xml' />
</head>
<body>
  <div class='container'>
    <div class='span-24' id='header'>
      <div class='prepend-1 span-11 append-8'>
        <a href='/'>
          <img src='/images/title.png' />
        </a>
      </div>
    </div>
    <div class='span-24' id='main'>
      <div class='prepend-1 span-15 append-1' id='content'>
        <div class='span-15 height-1'></div>
        <div class='span-15' id='content'>
          <div class='title'>
            <h2 class='entry-title'>
              <a href='/blog/2009/10/09/and-v.html'>
                and vs &amp;&amp; - Fight!
              </a>
            </h2>
          </div>
          <div class='post-date'>
            <abbr class='published' title='Fri Oct 09 14:22:34 -0400 2009'>
              Posted
              October 09, 2009
            </abbr>
          </div>
          <div class='entry-content'>
            <p>At <a href="http://hashrocket.com">Hashrocket</a> we are always expressing our views on code, both the good and the bad, about both our own code and code written by others. Recently, the issue of when to use the two flavors of Ruby logic operators: the punctation operators <code>&amp;&amp;</code>, <code>||</code>, <code>!</code> or the english operators <code>and</code>, <code>or</code>, <code>not</code>.</p>&#x000A;<p>Developers new to Ruby<sup class="footnote"><a href="#fn1">1</a></sup> should be following the rule to only use the punctuation operators for logic:</p>&#x000A;<pre><code>editable = user.admin? || item.editable?</code></pre>&#x000A;<pre><code>if user.admin? &amp;&amp; item.editable?</code></pre>&#x000A;<p>and the english operators for flow control:</p>&#x000A;<pre><code>render :action =&gt; 'edit' and return if editable</code></pre>&#x000A;<p>Once developers are proficient (see below for a quiz!) in Ruby, this rule should become a rule of thumb or just ignored.  For example, this reads better with <code>and</code>:</p>&#x000A;<pre><code>if user.admin? and item.editable?</code></pre>&#x000A;<p>So how do you know if you should be following the rule or just be aware of it? Answer this:</p>&#x000A;<p>What happens if we replace the <code>||</code> with <code>or</code> in the first example and why?<sup class="footnote"><a href="#fn2">2</a></sup></p>&#x000A;<p class="footnote" id="fn1"><sup>1</sup> Excluding those who are proficient in other languages and already recognize the issue.</p>&#x000A;<p class="footnote" id="fn2"><sup>2</sup> Did not know the answer?  Take a minute and learn <a href="http://phrogz.net/ProgrammingRuby/language.html#table_18.4">Ruby&#8217;s operator precedence</a></p>
          </div>
          <div class='comments'>
            <a href='/blog/2009/10/09/and-v.html#disqus_thread'>  </a>
          </div>
          <div class='title'>
            <h2 class='entry-title'>
              <a href='/blog/2009/09/29/best-practice-no-chains-in-controllers.html'>
                Best Practice: No Chains in Controllers
              </a>
            </h2>
          </div>
          <div class='post-date'>
            <abbr class='published' title='Tue Sep 29 23:39:00 -0400 2009'>
              Posted
              September 29, 2009
            </abbr>
          </div>
          <div class='entry-content'>
            <p>Dan Croak just posted <a href="http://robots.thoughtbot.com/post/200254501/testing-named-scopes">testing named scopes</a> which you should read right now.</p>&#x000A;<p>We also have been using the rule of thumb in the last paragraph: No Chains in Controllers.  Our experience is that not only do you immediately benefit from simpler tests, but we have also found that you get simpler and more expressive implementations.  If we do end up using a chain we usually encapsulate it in a method, keeping the tests and code clean.</p>
          </div>
          <div class='comments'>
            <a href='/blog/2009/09/29/best-practice-no-chains-in-controllers.html#disqus_thread'>  </a>
          </div>
          <div class='title'>
            <h2 class='entry-title'>
              <a href='/blog/2009/08/05/update-for-stub-chain-for-mocha.html'>
                Update for stub_chain for Mocha
              </a>
            </h2>
          </div>
          <div class='post-date'>
            <abbr class='published' title='Wed Aug 05 14:02:42 -0400 2009'>
              Posted
              August 05, 2009
            </abbr>
          </div>
          <div class='entry-content'>
            <p>Thanks to <a href="http://technicalpickles.com">Josh Nichols</a> for pointing out that the original code (and the RSpec mock code!) did not handle stubbing the same part of the chain multiple times, for example:</p>&#x000A;<pre><code>stub_chain(:votes, :supporting, :count).returns(supporting_count)&#x000A;stub_chain(:votes, :opposing, :count).returns(opposing_count)</code></pre>&#x000A;<p>Here is the updated snippet that works when you stub the same part of the chain multiple times:</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no"> 1</span> <span class="r">module</span> <span class="cl">StubChainMocha</span>&#x000A;<span class="no"> 2</span>   <span class="r">module</span> <span class="cl">Object</span>&#x000A;<span class="no"> 3</span>     <span class="r">def</span> <span class="fu">stub_chain</span>(*methods)&#x000A;<span class="no"> 4</span>       <span class="r">if</span> methods.length &gt; <span class="i">1</span>&#x000A;<span class="no"> 5</span>         next_in_chain = ::<span class="co">Object</span>.new&#x000A;<span class="no"> 6</span>         stubs(methods.shift).returns(next_in_chain)&#x000A;<span class="no"> 7</span>         next_in_chain.stub_chain(*methods)&#x000A;<span class="no"> 8</span>       <span class="r">else</span>&#x000A;<span class="no"> 9</span>         stubs(methods.shift)&#x000A;<span class="no"><strong>10</strong></span>       <span class="r">end</span>&#x000A;<span class="no">11</span>     <span class="r">end</span>&#x000A;<span class="no">12</span>   <span class="r">end</span>&#x000A;<span class="no">13</span> <span class="r">end</span>&#x000A;<span class="no">14</span> &#x000A;<span class="no">15</span> <span class="co">Object</span>.send(<span class="sy">:include</span>, <span class="co">StubChainMocha</span>::<span class="co">Object</span>)</pre></div>&#x000A;</div>&#x000A;<p>Copy that into <code>spec/stub_chain_mocha.rb</code> and then require it from <code>spec_helper.rb</code>.</p>
          </div>
          <div class='comments'>
            <a href='/blog/2009/08/05/update-for-stub-chain-for-mocha.html#disqus_thread'>  </a>
          </div>
          <div class='title'>
            <h2 class='entry-title'>
              <a href='/blog/2009/07/01/bouncy-bots.html'>
                Bouncy Bots!
              </a>
            </h2>
          </div>
          <div class='post-date'>
            <abbr class='published' title='Wed Jul 01 10:08:30 -0400 2009'>
              Posted
              July 01, 2009
            </abbr>
          </div>
          <div class='entry-content'>
            <h3>A simple negative captcha for Rails.</h3>&#x000A;<p>A negative captcha flips the normal captcha on its head, rather than asking humans identify themselves, we trick the bots into identifying themselves.  We do this by placing honey pots in a form that are invisible to a human, but visible to a bot.  When the bot submits the form, we look for the honey pot entries and discard the form submission if we find any.</p>&#x000A;<p>The source is MIT licensed and available on <a href="http://github.com/leshill/bouncy_bots/tree/master">github</a>.</p>&#x000A;<h3>Installing Bouncy Bots!</h3>&#x000A;<p>Bouncy Bots! is available as a gem from github.  Install the gem with the following command:</p>&#x000A;<pre><code>% sudo gem install --source http://gems.github.com/ leshill-bouncy_bots</code></pre>&#x000A;<p>After you have the gem installed, add a <code>config.gem</code> line to your <code>environment.rb</code> file:</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> config.gem <span class="s"><span class="dl">'</span><span class="k">leshill-bouncy_bots</span><span class="dl">'</span></span>, <span class="sy">:lib</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">bouncy_bots</span><span class="dl">'</span></span>, <span class="sy">:version</span> =&gt; <span class="fl">0.1</span>.<span class="i">0</span></pre></div>&#x000A;</div>&#x000A;<h3>Using Bouncy Bots!</h3>&#x000A;<h4>Controllers</h4>&#x000A;<p>Use the <code>bounce_bots</code> macro in your controllers to detect and bounce bots.  The macro takes two parameters, the honey pot field name and the redirect path or url.  For example, to check for the field <code>:blog_url</code> and redirect bots to the <code>pages_path</code> :</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> bounce_bots <span class="sy">:blog_url</span>, <span class="sy">:pages_path</span></pre></div>&#x000A;</div>&#x000A;<p>You can also pass the standard controller filter options such as <code>:only</code> or <code>:except</code> :</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> bounce_bots <span class="sy">:blog_url</span>, <span class="sy">:pages_path</span>, <span class="sy">:only</span> =&gt; [<span class="sy">:create</span>, <span class="sy">:update</span>]</pre></div>&#x000A;</div>&#x000A;<h4>Views</h4>&#x000A;<p>In your form views, add the honey pot field.  If you are using <code>form_tag</code>, you can use any form element, for example (using <a href="http://haml.hamptoncatlin.com/">haml</a>):</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> = text_field_tag <span class="sy">:blog_url</span>, <span class="pc">nil</span>, <span class="sy">:class</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">long_required</span><span class="dl">'</span></span></pre></div>&#x000A;</div>&#x000A;<p>In your stylesheet, add a rule to &#8216;hide&#8217; the field:</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> <span class="kw">input</span><span class="cl">.long_required</span> { <span class="ke">display</span>:<span class="vl">none</span>; }</pre></div>&#x000A;</div>&#x000A;<p>If you use <code>form_for</code>, there are two helpers to simplify making the honey pot.</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> = f.bounce_label <span class="s"><span class="dl">'</span><span class="k">Blog Url</span><span class="dl">'</span></span>, <span class="sy">:class</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">long_required</span><span class="dl">'</span></span>&#x000A;<span class="no">2</span> %br&#x000A;<span class="no">3</span> = f.bounce_field <span class="sy">:class</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">long_required</span><span class="dl">'</span></span></pre></div>&#x000A;</div>&#x000A;<p>And that&#8217;s it.</p>
          </div>
          <div class='comments'>
            <a href='/blog/2009/07/01/bouncy-bots.html#disqus_thread'>  </a>
          </div>
          <div class='prepend-1 span-15'>
            
            
            <a href="/index2.html">Next &rarr;</a>
          </div>
        </div>
      </div>
      <div class='span-6 append-1 last' id='sidebar'>
        <div class='span-6 height-1'></div>
        <div class='prepend-1 span-5' id='about'>
          <h2>About</h2>
          <ul>
            <li>
              Les Hill is a software adventurer who works with
              <a href='http://www.ruby-lang.org'>Ruby</a>
              at
              <a href='http://hashrocket.com'>Hashrocket</a>
              .
            </li>
            <li class='last'>
              Follow me on <a href="http://www.twitter.com/leshill">Twitter</a>
            </li>
          </ul>
        </div>
        <div class='prepend-1 span-5' id='twitter'></div>
        <div class='prepend-1 span-5'>
          <h2>Subscribe</h2>
          <ul>
            <li>
              <a class='feed' href='http://feeds2.feedburner.com/leshill'>RSS</a>
            </li>
          </ul>
        </div>
        <div class='prepend-1 span-5'>
          <div class='archives'>
            <h2>Archives</h2>
            <ul>
              <li class='year'>
                <a href='/blog/2009'>2009</a>
                <ul>
                  <li class='month'>
                    <a href='/blog/2009/01'>January</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/02'>February</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/04'>April</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/05'>May</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/06'>June</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/07'>July</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/08'>August</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/09'>September</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2009/10'>October</a>
                  </li>
                </ul>
              </li>
              <li class='year'>
                <a href='/blog/2008'>2008</a>
                <ul>
                  <li class='month'>
                    <a href='/blog/2008/2'>February</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2008/5'>May</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2008/7'>July</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2008/8'>August</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2008/10'>October</a>
                  </li>
                  <li class='month'>
                    <a href='/blog/2008/12'>December</a>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div class='span-24' id='footer'>
      <p>
        Wonderland is styled using
        <a href='http://www.blueprintcss.org/'>blueprint css</a>
        and powered by
        <a href='http://webby.rubyforge.org/'>Webby</a>
        and
        <a href='http://github.com/blog/272-github-pages'>GitHub Pages</a>
      </p>
      <p>
        Les Hill &copy; 2008&ndash;2009
      </p>
    </div>
  </div>
  <script type='text/javascript'>
    //<![CDATA[
      (function() {
        var links = document.getElementsByTagName('a');
        var query = '?';
        for(var i = 0; i < links.length; i++) {
          if(links[i].href.indexOf('#disqus_thread') >= 0) {
            query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
          }
        }
        document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/leshill/get_num_replies.js' + query + '"></' + 'script>');
      })();
    //]]>
  </script>
</body>
