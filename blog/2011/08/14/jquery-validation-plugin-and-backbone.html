<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
  <meta content='text/html; charset=utf-8' http-equiv='content-type' />
  <meta content='Les Hill' name='author' />
  <title>
    Les Hill &mdash; jQuery Validation plugin and Backbone
  </title>
  <link href='/css/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <link href='/css/coderay.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js' type='text/javascript'></script>
  <script src='/javascript/jquery.twitter.js' type='text/javascript'></script>
  <script src='/javascript/application.js' type='text/javascript'></script>
  <link href='http://feeds2.feedburner.com/leshill' rel='alternate' title='RSS feed' type='application/atom+xml' />
  <script type='text/javascript'>
    //<![CDATA[
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    //]]>
  </script>
  <script type='text/javascript'>
    //<![CDATA[
      try {
        var pageTracker = _gat._getTracker("UA-15974459-1");
        pageTracker._trackPageview();
      } catch(err) {}
    //]]>
  </script>
</head>
<body>
  <div class='site'>
    <div class='title'>
      <a href="/">Les Hill</a>
      <a href="http://github.com/leshill/" class="extra">github</a>
      <a href="http://twitter.com/leshill/" class="extra">twitter</a>
      <a href="http://facebook.com/leshill/" class="extra">facebook</a>
      <a href="http://www.linkedin.com/in/leshill/" class="extra">linked in</a>
      <a href="/archives.html" class="extra">archives</a>
    </div>
    <div id='post'>
      <div class='title'>
        <a href="/blog/2011/08/14/jquery-validation-plugin-and-backbone.html">jQuery Validation plugin and Backbone</a>
      </div>
      <div class='meta'>
        <abbr class='published' title='Sun Aug 14 12:47:51 -0700 2011'>
          Posted August 14, 2011
        </abbr>
      </div>
      <div class='content'>
        <p>Ready for some heresy? Let&#8217;s validate a <a href="http://documentcloud.github.com/backbone/">Backbone.js</a> model using the <a href="http://docs.jquery.com/Plugins/validation">jQuery Validation plugin</a> and a <code>View</code>.</p>&#x000A;<p>If you are interested in the heresy, skip to the bottom.</p>&#x000A;<p>Here is a simple sign up form for a Rails app. We want to validate that the user has entered an email address and filled in the password. Additionally, we would like to know if the email entered is available, so we will use AJAX to call down to the server to check availability dynamically.</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no"> 1</span> <span class="ta">&lt;form</span> <span class="an">accept-charset</span>=<span class="s"><span class="dl">&quot;</span><span class="k">UTF-8</span><span class="dl">&quot;</span></span> <span class="an">action</span>=<span class="s"><span class="dl">&quot;</span><span class="k">#</span><span class="dl">&quot;</span></span> <span class="an">class</span>=<span class="s"><span class="dl">&quot;</span><span class="k">validate</span><span class="dl">&quot;</span></span> <span class="an">id</span>=<span class="s"><span class="dl">&quot;</span><span class="k">new_user</span><span class="dl">&quot;</span></span> <span class="an">method</span>=<span class="s"><span class="dl">&quot;</span><span class="k">post</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no"> 2</span>   <span class="ta">&lt;div</span> <span class="an">style</span>=<span class="s"><span class="dl">&quot;</span><span class="k">margin:0;padding:0;display:inline</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no"> 3</span>     <span class="ta">&lt;input</span> <span class="an">name</span>=<span class="s"><span class="dl">&quot;</span><span class="k">utf8</span><span class="dl">&quot;</span></span> <span class="an">type</span>=<span class="s"><span class="dl">&quot;</span><span class="k">hidden</span><span class="dl">&quot;</span></span> <span class="an">value</span>=<span class="s"><span class="dl">&quot;</span><span class="k">âœ“</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no"> 4</span>     <span class="ta">&lt;input</span> <span class="an">name</span>=<span class="s"><span class="dl">&quot;</span><span class="k">authenticity_token</span><span class="dl">&quot;</span></span> <span class="an">type</span>=<span class="s"><span class="dl">&quot;</span><span class="k">hidden</span><span class="dl">&quot;</span></span> <span class="an">value</span>=<span class="s"><span class="dl">&quot;</span><span class="k">dkjfhioeutgdkjdkfj</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no"> 5</span>   <span class="ta">&lt;/div&gt;</span>&#x000A;<span class="no"> 6</span>   <span class="ta">&lt;p&gt;</span>&#x000A;<span class="no"> 7</span>     <span class="ta">&lt;label</span> <span class="an">for</span>=<span class="s"><span class="dl">&quot;</span><span class="k">user_email</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>Your email<span class="ta">&lt;/label&gt;</span>&#x000A;<span class="no"> 8</span>     <span class="ta">&lt;input</span> <span class="an">class</span>=<span class="s"><span class="dl">&quot;</span><span class="k">text required email</span><span class="dl">&quot;</span></span> <span class="an">id</span>=<span class="s"><span class="dl">&quot;</span><span class="k">user_email</span><span class="dl">&quot;</span></span> <span class="an">name</span>=<span class="s"><span class="dl">&quot;</span><span class="k">user[email]</span><span class="dl">&quot;</span></span> <span class="an">size</span>=<span class="s"><span class="dl">&quot;</span><span class="k">30</span><span class="dl">&quot;</span></span> <span class="an">type</span>=<span class="s"><span class="dl">&quot;</span><span class="k">email</span><span class="dl">&quot;</span></span> <span class="an">value</span>=<span class="s"><span class="dl">&quot;</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no"> 9</span>   <span class="ta">&lt;/p&gt;</span>&#x000A;<span class="no"><strong>10</strong></span>   <span class="ta">&lt;p&gt;</span>&#x000A;<span class="no">11</span>     <span class="ta">&lt;label</span> <span class="an">for</span>=<span class="s"><span class="dl">&quot;</span><span class="k">user_password</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>Choose a password<span class="ta">&lt;/label&gt;</span>&#x000A;<span class="no">12</span>     <span class="ta">&lt;input</span> <span class="an">autocomplete</span>=<span class="s"><span class="dl">&quot;</span><span class="k">off</span><span class="dl">&quot;</span></span> <span class="an">class</span>=<span class="s"><span class="dl">&quot;</span><span class="k">text required</span><span class="dl">&quot;</span></span> <span class="an">id</span>=<span class="s"><span class="dl">&quot;</span><span class="k">user_password</span><span class="dl">&quot;</span></span> <span class="an">name</span>=<span class="s"><span class="dl">&quot;</span><span class="k">user[password]</span><span class="dl">&quot;</span></span> <span class="an">size</span>=<span class="s"><span class="dl">&quot;</span><span class="k">30</span><span class="dl">&quot;</span></span> <span class="an">type</span>=<span class="s"><span class="dl">&quot;</span><span class="k">text</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no">13</span>   <span class="ta">&lt;/p&gt;</span>&#x000A;<span class="no">14</span>   <span class="ta">&lt;p</span> <span class="an">class</span>=<span class="s"><span class="dl">&quot;</span><span class="k">buttons</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no">15</span>     <span class="ta">&lt;input</span> <span class="an">name</span>=<span class="s"><span class="dl">&quot;</span><span class="k">commit</span><span class="dl">&quot;</span></span> <span class="an">type</span>=<span class="s"><span class="dl">&quot;</span><span class="k">submit</span><span class="dl">&quot;</span></span> <span class="an">value</span>=<span class="s"><span class="dl">&quot;</span><span class="k">Get started</span><span class="dl">&quot;</span></span><span class="ta">&gt;</span>&#x000A;<span class="no">16</span>   <span class="ta">&lt;/p&gt;</span>&#x000A;<span class="no">17</span> <span class="ta">&lt;/form&gt;</span></pre></div>&#x000A;</div>&#x000A;&#x000A;<p>As a starting point, this is how we might use Validation with jQuery to validate our form.</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no"> 1</span> <span class="pd">$</span>(<span class="s"><span class="dl">'</span><span class="k">#new_user</span><span class="dl">'</span></span>).validate({&#x000A;<span class="no"> 2</span>   <span class="ke">rules</span>: {&#x000A;<span class="no"> 3</span>     <span class="ke"><span class="dl">'</span><span class="k">user[email]</span><span class="dl">'</span></span>: {&#x000A;<span class="no"> 4</span>       <span class="ke">required</span>: <span class="pc">true</span>,&#x000A;<span class="no"> 5</span>       <span class="ke">email</span>: <span class="pc">true</span>,&#x000A;<span class="no"> 6</span>       <span class="ke">remote</span>: <span class="s"><span class="dl">'</span><span class="k">/users/email_available</span><span class="dl">'</span></span>&#x000A;<span class="no"> 7</span>     },&#x000A;<span class="no"> 8</span>     <span class="ke"><span class="dl">'</span><span class="k">user[password]</span><span class="dl">'</span></span>: {&#x000A;<span class="no"> 9</span>       <span class="ke">required</span>: <span class="pc">true</span>,&#x000A;<span class="no"><strong>10</strong></span>       <span class="ke">minlength</span>: <span class="i">6</span>&#x000A;<span class="no">11</span>     }&#x000A;<span class="no">12</span>   },&#x000A;<span class="no">13</span>   <span class="ke">messages</span>: {&#x000A;<span class="no">14</span>     <span class="ke"><span class="dl">'</span><span class="k">user[email]</span><span class="dl">'</span></span>: {&#x000A;<span class="no">15</span>       <span class="ke">remote</span>: <span class="pd">$</span>.format(<span class="s"><span class="dl">'</span><span class="k">{0} has already been taken</span><span class="dl">'</span></span>)&#x000A;<span class="no">16</span>     }&#x000A;<span class="no">17</span>   },&#x000A;<span class="no">18</span>   <span class="fu">submitHandler</span>: <span class="kw">function</span>(form) {&#x000A;<span class="no">19</span>     <span class="kw">var</span> form = <span class="pd">$</span>(form);&#x000A;<span class="no"><strong>20</strong></span>     <span class="kw">var</span> form_data = form.formParams()&#x000A;<span class="no">21</span>     <span class="pd">$</span>.ajax({&#x000A;<span class="no">22</span>       <span class="ke">url</span>: form.attr(<span class="s"><span class="dl">'</span><span class="k">action</span><span class="dl">'</span></span>),&#x000A;<span class="no">23</span>       <span class="ke">dataType</span>: <span class="s"><span class="dl">'</span><span class="k">json</span><span class="dl">'</span></span>,&#x000A;<span class="no">24</span>       <span class="ke">type</span>: <span class="s"><span class="dl">&quot;</span><span class="k">POST</span><span class="dl">&quot;</span></span>,&#x000A;<span class="no">25</span>       <span class="ke">data</span>: form_data,&#x000A;<span class="no">26</span>       <span class="fu">success</span>: <span class="kw">function</span> (data, textStatus, xhr) {&#x000A;<span class="no">27</span>         <span class="c">// code for cleaning up form and showing response here...</span>&#x000A;<span class="no">28</span>       },&#x000A;<span class="no">29</span>       <span class="fu">error</span>: <span class="kw">function</span> (xhr, textStatus, errorThrown) {&#x000A;<span class="no"><strong>30</strong></span>         <span class="c">// code for showing errors here...</span>&#x000A;<span class="no">31</span>       }&#x000A;<span class="no">32</span>     });&#x000A;<span class="no">33</span>   }&#x000A;<span class="no">34</span> });</pre></div>&#x000A;</div>&#x000A;&#x000A;<p>If you have not used the Validation plugin before, it is a simple declarative way to validate forms. You specify the rules which apply to your form&#8217;s input elements and they are checked as the user enters data and on submit. All the usual validations are provided by the plugin, including <code>remote</code> which will make an Ajax call to your server to check the input. Messages for failed validations can be customized. And there are quite a few options available to change the behavior of the plugin.</p>&#x000A;<p>Now lets do this with a Backbone.js <code>View</code>.</p>&#x000A;<p>We will create a basic <code>FormView</code> class to handle both create and edit, using a templated form. That is the extent of our brief for this blog post, a much more complete class is left as an exercise for the reader.</p>&#x000A;<p>Oh and we are using <a href="http://jashkenas.github.com/coffee-script/">CoffeeScript</a>.</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no"> 1</span> <span class="r">class</span> <span class="cl">FormView</span> extends <span class="co">Backbone</span>.<span class="co">View</span>&#x000A;<span class="no"> 2</span>   <span class="sy">initialize:</span> -&gt;&#x000A;<span class="no"> 3</span>     <span class="iv">@template</span> = _.template(<span class="er">$</span>(<span class="iv">@templateSelector</span>).html())&#x000A;<span class="no"> 4</span>     <span class="iv">@validationOptions</span> = <span class="iv">@options</span>.validationOptions&#x000A;<span class="no"> 5</span> &#x000A;<span class="no"> 6</span>   <span class="sy">fetchParams:</span> (form) -&gt;&#x000A;<span class="no"> 7</span>     rawdata = <span class="er">$</span>(form).serialize()&#x000A;<span class="no"> 8</span>     data = <span class="gv">$.</span>deparam(rawdata)&#x000A;<span class="no"> 9</span>     data[<span class="s"><span class="dl">'</span><span class="k">user</span><span class="dl">'</span></span>]&#x000A;<span class="no"><strong>10</strong></span> &#x000A;<span class="no">11</span>   <span class="sy">render:</span> -&gt;&#x000A;<span class="no">12</span>     template_values = <span class="r">if</span> <span class="iv">@model</span> <span class="r">then</span> <span class="iv">@model</span>.toJSON() <span class="r">else</span> {}&#x000A;<span class="no">13</span>     <span class="er">$</span>(<span class="iv">@el</span>).html(<span class="iv">@template</span>(template_values))&#x000A;<span class="no">14</span>     opts = { <span class="sy">submitHandler:</span> <span class="iv">@submit</span> }&#x000A;<span class="no">15</span>     opts = _.extend(opts, <span class="iv">@validationOptions</span>)&#x000A;<span class="no">16</span>     <span class="er">$</span>(<span class="iv">@el</span>).find(<span class="s"><span class="dl">'</span><span class="k">form</span><span class="dl">'</span></span>).validate(opts)&#x000A;<span class="no">17</span>     this&#x000A;<span class="no">18</span> &#x000A;<span class="no">19</span>   <span class="sy">submit:</span> (form) =&gt;&#x000A;<span class="no"><strong>20</strong></span>     <span class="r">if</span> <span class="iv">@model</span>&#x000A;<span class="no">21</span>       <span class="iv">@model</span>.save(fetchParams(form))&#x000A;<span class="no">22</span>     <span class="r">else</span>&#x000A;<span class="no">23</span>       <span class="iv">@collection</span>.create(fetchParams(form))&#x000A;<span class="no">24</span> &#x000A;<span class="no">25</span> <span class="r">class</span> <span class="cl">User</span> extends <span class="co">Backbone</span>.<span class="co">Model</span>&#x000A;<span class="no">26</span> &#x000A;<span class="no">27</span> users = new <span class="co">Collection</span>&#x000A;<span class="no">28</span>   <span class="sy">model:</span> <span class="co">User</span>&#x000A;<span class="no">29</span>   <span class="sy">url:</span> <span class="s"><span class="dl">'</span><span class="k">/users</span><span class="dl">'</span></span>&#x000A;<span class="no"><strong>30</strong></span> &#x000A;<span class="no">31</span> view = new <span class="co">FormView</span>&#x000A;<span class="no">32</span>   <span class="sy">collection:</span> users&#x000A;<span class="no">33</span>   <span class="sy">el:</span> <span class="er">$</span>(<span class="s"><span class="dl">'</span><span class="k">#signup_form</span><span class="dl">'</span></span>)&#x000A;<span class="no">34</span>   <span class="sy">templateSelector:</span> <span class="s"><span class="dl">'</span><span class="k">#new_user_form</span><span class="dl">'</span></span>&#x000A;<span class="no">35</span>   validationOptions:&#x000A;<span class="no">36</span>     rules:&#x000A;<span class="no">37</span>       <span class="s"><span class="dl">'</span><span class="k">user[email]</span><span class="dl">'</span></span>:&#x000A;<span class="no">38</span>         <span class="sy">remote:</span> <span class="s"><span class="dl">'</span><span class="k">/users/email_available</span><span class="dl">'</span></span>&#x000A;<span class="no">39</span>       <span class="s"><span class="dl">'</span><span class="k">user[password]</span><span class="dl">'</span></span>:&#x000A;<span class="no"><strong>40</strong></span>         <span class="sy">minlength:</span> <span class="i">6</span>&#x000A;<span class="no">41</span>     messages:&#x000A;<span class="no">42</span>       <span class="s"><span class="dl">'</span><span class="k">user[email]</span><span class="dl">'</span></span>:&#x000A;<span class="no">43</span>         <span class="sy">remote:</span> <span class="gv">$.</span>format(<span class="s"><span class="dl">'</span><span class="k">{0} has already been taken</span><span class="dl">'</span></span>)&#x000A;<span class="no">44</span> &#x000A;<span class="no">45</span> view.render()</pre></div>&#x000A;</div>&#x000A;&#x000A;<p>The <code>FormView</code> class can handle either creating a new model or editing an existing model. When creating a new object pass in the <code>collection</code> as an option, and when editing an existing model pass in the <code>model</code> as an option. You need to specify the <code>el</code> where the <code>FormView</code> will render the form, and the <code>templateSelector</code> that will identify the <a href="http://documentcloud.github.com/underscore/#template">Underscore.js template</a>. And of course you need to specify the validation rules, messages, and options for the Validation plugin, but <strong>not</strong> a <code>submitHandler</code>.</p>&#x000A;<p>Fire things up by calling <code>render</code>, and our form will now validate and if successfully validated, submit. Done!</p>&#x000A;<p>Here are some things to note:</p>&#x000A;<p>We are using classes on the inputs to indicate the basic Validation rules to apply.</p>&#x000A;<p>The <code>validationOptions</code> do not include the <code>submitHandler</code>, which is added by the <code>FormView</code>.</p>&#x000A;<p>We are also using the <code>jquery.ba-bbq</code> plugin for the <code>deparam</code> method it adds to jQuery<sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup>.</p>&#x000A;<h2>Heresy!</h2>&#x000A;<p>On to the heresy. MVC dogma would say that the model should be responsible for its validation, and here the view is doing the validation &mdash; the Validation plugin is part of the <code>FormView</code> view internals.</p>&#x000A;<h3>Pragmatism</h3>&#x000A;<p>The existing model validation scheme for Backbone.js is weak. There is no easy declarative way to validate models at the moment. I am hopeful that Derrick Bailey&#8217;s <a href="https://github.com/derickbailey/backbone.modelbinding">Backbone.ModelBinding</a> will eventually lead to an answer. On the other hand, the jQuery Validation plugin already works and works well with very little coding required.</p>&#x000A;<h3>Does &lsquo;dogma&rsquo; even apply?</h3>&#x000A;<p>The remote email validation does not find neatly into the usual MVC validation scheme. If you have done this in Rails, you no doubt have written code that is not part of the normal validation process to achieve this. What is being validated is a single data field from a model independent of the model itself &mdash; and Backbone.js is no different: <code>validate</code> operates on a model instance.</p>&#x000A;<p>Another way to think of this is that the view is gathering and validating input before passing it onto the model. In this case, the validation is part of the behavior of the form and the individual inputs, with the view doing the availabilty check as soon as there is an email address entered by the user. Once the view is valid, the submit passes the data onto the model. And of course, the model on the server is doing its own validations. And the model on the client? It is a one-liner, just a data container for passing data cleanly along from the view (which is doing the interesting work) to the model on the server. The crux is that the input &ldquo;validation&rdquo; is substantially more than just an &ldquo;email must be unique&rdquo; validation on the model, it is the user experience around entering potentially incorrect data.</p>&#x000A;<p>I am not convinced that MVC is misplaced here. Given a different framework, the model&#8217;s validations could be flexible enough to really accomodate this scenario. Another possiblity is that this MVC is widget-y and hidden within my Backbone.js view. But for the time being, I am happy to keep shipping and live with this heresy.</p>&#x000A;<p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> Why is this not in jQuery? Why is something like this not a standalone plugin?</p>
      </div>
      <div class='comments'>
        <div id='disqus_thread'></div>
        <script src='http://disqus.com/forums/leshill/embed.js' type='text/javascript'></script>
        <noscript>
          <a href="http://leshill.disqus.com/?url=ref">View the discussion thread.</a>
        </noscript>
        <a class='dsq-brlink' href='http://disqus.com'>
          blog comments powered by
          <span class='logo-disqus'>
            Disqus
          </span>
        </a>
      </div>
    </div>
    <div class='footer'>
      <div class='contact'>
        <p>
          Les Hill
          <br />
          Developer @ <a href="http://pictureofhealth.com/">Picture of Health</a>
          <br />
          les (at) picutreofhealth (dot) com
        </p>
      </div>
      <div class='rss'>
        <a href='http://feeds2.feedburner.com/leshill'>
          <img alt='Subscribe to RSS Feed' src='/images/feed-icon-28x28.png' />
        </a>
      </div>
    </div>
    <div class='colophon'>
      <p>
        Thanks to <a href="http://tom.preston-werner.com/">Tom Preston-Werner</a>
        for the CSS layout, <a href="http://webby.rubyforge.org/">Webby</a> for
        the blog renderer, and
        <a href="http://github.com/blog/272-github-pages">GitHub Pages</a> for
        the blog hosting.
      </p>
      <div class='copyright'>
        <p>
          Les Hill &copy; 2008&ndash;2011
        </p>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        (function() {
          var links = document.getElementsByTagName('a');
          var query = '?';
          for(var i = 0; i < links.length; i++) {
            if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
            }
          }
          document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/leshill/get_num_replies.js' + query + '"></' + 'script>');
        })();
      //]]>
    </script>
  </div>
</body>
