<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
  <meta content='text/html; charset=utf-8' http-equiv='content-type' />
  <meta content='Les Hill' name='author' />
  <title>
    Les Hill &mdash; Bouncy Bots!
  </title>
  <link href='/css/screen.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <link href='/css/coderay.css' media='screen, projection' rel='stylesheet' type='text/css' />
  <script src='http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js' type='text/javascript'></script>
  <script src='/javascript/jquery.twitter.js' type='text/javascript'></script>
  <script src='/javascript/application.js' type='text/javascript'></script>
  <link href='http://feeds2.feedburner.com/leshill' rel='alternate' title='RSS feed' type='application/atom+xml' />
</head>
<body>
  <div class='site'>
    <div class='title'>
      <a href="/">Les Hill</a>
      <a href="http://twitter.com/leshill/" class="extra">twitter</a>
      <a href="http://github.com/leshill/" class="extra">github</a>
      <a href="/archives.html" class="extra">archives</a>
    </div>
    <div id='post'>
      <div class='title'>
        <a href="/blog/2009/07/01/bouncy-bots.html">Bouncy Bots!</a>
      </div>
      <div class='meta'>
        <abbr class='published' title='Wed Jul 01 10:08:30 -0400 2009'>
          Posted July 01, 2009
        </abbr>
      </div>
      <div class='content'>
        <h3>A simple negative captcha for Rails.</h3>&#x000A;<p>A negative captcha flips the normal captcha on its head, rather than asking humans identify themselves, we trick the bots into identifying themselves.  We do this by placing honey pots in a form that are invisible to a human, but visible to a bot.  When the bot submits the form, we look for the honey pot entries and discard the form submission if we find any.</p>&#x000A;<p>The source is MIT licensed and available on <a href="http://github.com/leshill/bouncy_bots/tree/master">github</a>.</p>&#x000A;<h3>Installing Bouncy Bots!</h3>&#x000A;<p>Bouncy Bots! is available as a gem from github.  Install the gem with the following command:</p>&#x000A;<pre><code>% sudo gem install --source http://gems.github.com/ leshill-bouncy_bots</code></pre>&#x000A;<p>After you have the gem installed, add a <code>config.gem</code> line to your <code>environment.rb</code> file:</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> config.gem <span class="s"><span class="dl">'</span><span class="k">leshill-bouncy_bots</span><span class="dl">'</span></span>, <span class="sy">:lib</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">bouncy_bots</span><span class="dl">'</span></span>, <span class="sy">:version</span> =&gt; <span class="fl">0.1</span>.<span class="i">0</span></pre></div>&#x000A;</div>&#x000A;<h3>Using Bouncy Bots!</h3>&#x000A;<h4>Controllers</h4>&#x000A;<p>Use the <code>bounce_bots</code> macro in your controllers to detect and bounce bots.  The macro takes two parameters, the honey pot field name and the redirect path or url.  For example, to check for the field <code>:blog_url</code> and redirect bots to the <code>pages_path</code> :</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> bounce_bots <span class="sy">:blog_url</span>, <span class="sy">:pages_path</span></pre></div>&#x000A;</div>&#x000A;<p>You can also pass the standard controller filter options such as <code>:only</code> or <code>:except</code> :</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> bounce_bots <span class="sy">:blog_url</span>, <span class="sy">:pages_path</span>, <span class="sy">:only</span> =&gt; [<span class="sy">:create</span>, <span class="sy">:update</span>]</pre></div>&#x000A;</div>&#x000A;<h4>Views</h4>&#x000A;<p>In your form views, add the honey pot field.  If you are using <code>form_tag</code>, you can use any form element, for example (using <a href="http://haml.hamptoncatlin.com/">haml</a>):</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> = text_field_tag <span class="sy">:blog_url</span>, <span class="pc">nil</span>, <span class="sy">:class</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">long_required</span><span class="dl">'</span></span></pre></div>&#x000A;</div>&#x000A;<p>In your stylesheet, add a rule to &#8216;hide&#8217; the field:</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> <span class="kw">input</span><span class="cl">.long_required</span> { <span class="ke">display</span>:<span class="vl">none</span>; }</pre></div>&#x000A;</div>&#x000A;<p>If you use <code>form_for</code>, there are two helpers to simplify making the honey pot.</p>&#x000A;<div class="CodeRay">&#x000A;  <div class="code"><pre><span class="no">1</span> = f.bounce_label <span class="s"><span class="dl">'</span><span class="k">Blog Url</span><span class="dl">'</span></span>, <span class="sy">:class</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">long_required</span><span class="dl">'</span></span>&#x000A;<span class="no">2</span> %br&#x000A;<span class="no">3</span> = f.bounce_field <span class="sy">:class</span> =&gt; <span class="s"><span class="dl">'</span><span class="k">long_required</span><span class="dl">'</span></span></pre></div>&#x000A;</div>&#x000A;<p>And that&#8217;s it.</p>
      </div>
      <div class='comments'>
        <div id='disqus_thread'></div>
        <script src='http://disqus.com/forums/leshill/embed.js' type='text/javascript'></script>
        <noscript>
          <a href="http://leshill.disqus.com/?url=ref">View the discussion thread.</a>
        </noscript>
        <a class='dsq-brlink' href='http://disqus.com'>
          blog comments powered by
          <span class='logo-disqus'>
            Disqus
          </span>
        </a>
      </div>
    </div>
    <div class='footer'>
      <div class='contact'>
        <p>
          Les Hill
          <br />
          Software adventurer @
          <a href='http://hashrocket.com/'>
            Hashrocket
          </a>
          <br />
          les (at) hashrocket (dot) com
        </p>
      </div>
      <div class='rss'>
        <a href='http://feeds2.feedburner.com/leshill'>
          <img alt='Subscribe to RSS Feed' src='/images/feed-icon-28x28.png' />
        </a>
      </div>
    </div>
    <div class='colophon'>
      <p>
        Thanks to
        <a href='http://tom.preston-werner.com/'>
          Tom Preston-Werner
        </a>
        for the CSS layout,
        <a href='http://webby.rubyforge.org/'>
          Webby
        </a>
        for the blog renderer,
        and
        <a href='http://github.com/blog/272-github-pages'>
          GitHub Pages
        </a>
        for the blog hosting.
      </p>
      <div class='copyright'>
        <p>
          Les Hill &copy; 2008&ndash;2009
        </p>
      </div>
    </div>
    <script type='text/javascript'>
      //<![CDATA[
        (function() {
          var links = document.getElementsByTagName('a');
          var query = '?';
          for(var i = 0; i < links.length; i++) {
            if(links[i].href.indexOf('#disqus_thread') >= 0) {
              query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&amp;';
            }
          }
          document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/leshill/get_num_replies.js' + query + '"></' + 'script>');
        })();
      //]]>
    </script>
  </div>
</body>
